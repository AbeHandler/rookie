<html>
<head>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.4.5/css/foundation.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.css">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.4.1/js/foundation.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script type="text/javascript" src="{{ROOKIE_JS}}"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.7/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
<link rel="stylesheet" href="{{ROOKIE_CSS}}"></link>
<title>Rookie</title>
{% include 'head.html' %}
</head>

<body>
{% include 'banner.html' %}

<div id="controls" class="row">

  <div>
    <div class="small-10 columns">
      <input id="search_bar" type="text" class="small-12 columns" placeholder="{{query}}"></input>
    </div>
    <div class="small-2 columns">
      <a href="#" class="button postfix" id="search_button">Search</a>
    </div>
  </div>

</div>

<!--
<div class="toggler row">
    <div class="columns small-3 right" id="datepickers">
      <div class="columns"><p>Start date: <input type="text" id="datepicker1"></p></div>
      <div class="columns"><p>End date: <input type="text" id="datepicker2"></p></div>
    </div>
</div>
-->

<div class="main-content">
  <div class="small-12 columns">
    <div class="row">Common subjects in articles matching {{query}}</div>
    <div id="q_chart">
    </div>
  </div>

</div>

  <script type="text/javascript">
      
      dummy =  ['count', 0, 0, 0, 0, 0, 0];
      q_data = {{data | safe }};
      q_labels = {{labels | safe }}
      var chart = c3.generate({
    data: {
        x: 'x',
        columns: [
           {{labels | safe }},
            {{data | safe }},
            ['data2', 200, 130, 90, 240, 130, 3],
            ['data3', 300, 200, 160, 400, 250, 3],
            ['data4', 200, 130, 90, 240, 130, 3],
            ['data5', 130, 120, 150, 140, 160, 3],
            ['data6', 90, 70, 20, 50, 60, 3],
        ],
        type: 'timeseries',
        types: {
            count: 'spline',
            data3: 'spline',
            data4: 'line',
            data6: 'area',
        }
    },
     bindto: '#q_chart',
    axis: {
        x: {
            type: 'timeseries',
            tick: {
                format: '%Y'
            }
        }
    }
});
     /* function make_chart(term, show_axis){
        var width = $(".charts").first();
        c3.generate({
         bindto: '#q-chart',
         size: {
            height: 50,
            width: 200
         },
         bindto: '#q-chart',
        data: {
            x: 'x',
            columns: [
               ['x' {{data | safe }}],
               window["v" + term]
            ],
            type: 'area-spline',
            colors: {
                  x: '#ff0000',
                  count: '#B33125'
            },
            color: function (color, d) {
                  // d will be 'id' when called for legends
                  return d.id && d.id === 'data3' ? d3.rgb(color).darker(d.value / 150) : color;
            },
        },
        tooltip: {
            show: true
        },
        legend: {
            show: false
        },
        axis: {
            x: {
                type: 'timeseries',
                tick: {
                    format: '%Y'
                },
                show: show_axis
            },
            y: {
              show:false
            }
        }
       }); */
      
      var facet_count = $(".facet").length;

      $(".facet").each(function(i, id){
        var facet = id.id.replace("-label", "");
        var axis = false;
        if (id.id.replace("-label", "") == "dummy"){
          axis = false;
        }
        make_chart(facet, axis);
      });

      $('.page').on("click", function(e){
        var page = parseInt(this.dataset.page);
        if (this.id == "next"){
          page += 1;
        }else{
          page -= 1;
        }
        get_results(page);
      });

      $("#search_bar").val($.QueryString["q"]);

  </script>

</body>
</html>